var page=new Object;page.setSelectedMenus=function(ids){var arr=ids.split(",");for(var i=0;i<arr.length;i++){if(i!=null&&i>0){$("#menu_item_"+arr[i]).addClass("active")}}};page.initTableHeight=function(){var d=$(".content-list > .panel");if(d.length>0){var s=d.parent();if(s[0].offsetWidth<s[0].scrollWidth){var h=$(window).height()-40;if(d.height()>h)d.parent().height(h)}else{d.parent().height("auto")}}};page.setMainRole=function(id){var formData="id="+id;$.ajax({type:"POST",url:"/site/setRole",data:formData,dataType:"json",success:function(json){if(json.state==0){inc.showNotice("操作成功");location.reload()}else{alertModel(json.data)}},error:function(data){alertModel("操作失败："+data.responseText)}})};function AttachModel(domId,baseId,controller){var self=this;$("#"+domId).find(".file-upload").each(function(){var self=$(this);var btnText=self.prev();var fileNameTd=self.parent().parent().prev("td.file-name");var maxSize=parseInt(fileNameTd.data("maxsize"))*1024*1024;var permitFileType=fileNameTd.data("filetype");self.fileupload({url:"/"+controller+"/saveFile/",dataType:"json",autoUpload:true,add:function(e,data){if(!inc.checkFileType(data.files[0].name,permitFileType)){layer.alert("只能上传指定类型的文件："+permitFileType,{icon:5});return}if(data.files[0].size>maxSize){layer.alert("文件大小超出最大限制："+fileNameTd.data("maxsize")+"M",{icon:5});return}btnText.html("正在上传文件。。。");data.formData={id:baseId,type:fileNameTd.data("type")};data.submit()},done:function(e,data){if(data.result.state==0){fileNameTd.prev().prev().html('<span class="glyphicon glyphicon-ok text-green"></span>');var fDom=$("<p id='i_"+data.result.data+"'  class='form-control-static file'></p>").append($("<a target='_blank' class='btn btn-primary btn-xs'></a>").attr("href","/"+controller+"/getFile/?id="+data.result.data+"&fileName="+data.result.extra.name).html(data.result.extra.name)).append("&emsp;&emsp;").append($('<a class="btn btn-danger btn-xs del-btn" onclick="page.delAttachment('+data.result.data+",'"+controller+"')\">删除</a>"));if(fileNameTd.data("multi")==1){fileNameTd.find(".file-list").append(fDom);btnText.html("继续上传")}else{fileNameTd.find(".file-list").html(fDom);btnText.html("重新上传")}}else{layer.alert(data.result.data,{icon:5});btnText.html("上传")}},fail:function(){layer.alert("上传出错，请稍后重试！",{icon:5});btnText.html("上传")}})});self.del=function(id){page.delAttachment(id,controller)}}page.delAttachment=function(id,controller){layer.confirm("您确定删除当前已经上传的文件吗，该操作不可逆？",{icon:3,title:"提示"},function(index){var formData="id="+id;$.ajax({type:"POST",url:"/"+controller+"/delFile",data:formData,dataType:"json",success:function(json){if(json.state==0){inc.showNotice("操作成功");var fileNameTd=$("#i_"+id).parents("td.file-name");var btnText=fileNameTd.parent().find(".btn-text");$("#i_"+id).remove();if(fileNameTd.data("multi")!=1||fileNameTd.find(".file-list").children("p").length<1){fileNameTd.prev().prev().html('<span class="glyphicon glyphicon glyphicon-remove text-red"></span>');btnText.html("上传")}}else{layer.alert(json.data,{icon:5})}},error:function(data){layer.alert("操作失败："+data.responseText,{icon:5})}});layer.close(index)})};page.showProject=function(){var project_code=$("#top_search_key").val();if(project_code==null||project_code=="")return;$.ajax({type:"GET",url:"/project/getIdByCode",data:{project_code:project_code},dataType:"json",success:function(json){if(json.state==0){console.log(json);inc.a("/project/detail/?t=1&id="+json.data)}else{layer.alert(json.data,{icon:5})}},error:function(data){layer.alert("操作失败！"+data.responseText)}})};page.keyDownSearch=function(e){var event=e||window.event;var code=event.keyCode||event.which||event.charCode;if(code==13){page.showProject()}};page.initDataTables=function(selector,options){if(!selector){selector="table.data-table"}$(function(){var table=$(selector);if(table.length<=0)return;var ths=table.find("thead>tr>th");var trs=table.find("tbody>tr");if(trs.length===1){var td=trs.find("td");if(td.length===1){for(var i=1;i<ths.length;i++)trs.append('<td class="hidden"></td>')}}if(!options&&table.data("config"))options=eval("("+table.data("config")+")");var defaults={scrollCollapse:true,scrollX:true,info:false,order:[],fixedHeader:true,language:{emptyTable:"<div style='padding-left: 150px; font-weight: bold;'>暂时没有数据</div>"},searching:false,paging:false};var s=table.parent();if(table[0].offsetWidth+30*ths.length>s[0].offsetWidth){defaults["scrollY"]=$(window).height()-180}var o=$.extend(defaults,options);table.DataTable(o)})};